<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        //Callback trong l·∫≠p tr√¨nh l√† m·ªôt h√†m ho·∫∑c ph∆∞∆°ng th·ª©c ƒë∆∞·ª£c truy·ªÅn v√†o nh∆∞ l√† m·ªôt tham s·ªë trong m·ªôt h√†m
// ho·∫∑c ph∆∞∆°ng th·ª©c kh√°c, v√† ƒë∆∞·ª£c g·ªçi sau khi h√†m ho·∫∑c ph∆∞∆°ng th·ª©c g·ªëc ho√†n th√†nh.
//  Callback th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ gi·∫£i quy·∫øt vi·ªác t∆∞∆°ng t√°c gi·ªØa nhi·ªÅu h√†m ho·∫∑c ph∆∞∆°ng th·ª©c trong m·ªôt ch∆∞∆°ng tr√¨nh.
// API (Application Programming Interface) trong l·∫≠p tr√¨nh l√† m·ªôt t·∫≠p h·ª£p c√°c giao di·ªán, protocol v√† c√°c quy t·∫Øc cho ph√©p c√°c ph·∫ßn m·ªÅm ho·∫∑c h·ªá th·ªëng t∆∞∆°ng t√°c v·ªõi nhau. API cho ph√©p m·ªôt ph·∫ßn m·ªÅm g·ªçi c√°c d·ªãch v·ª•, t√≠nh nƒÉng ho·∫∑c d·ªØ li·ªáu c·ªßa m·ªôt h·ªá th·ªëng kh√°c m√† kh√¥ng c·∫ßn bi·∫øt chi ti·∫øt v·ªÅ c√°ch th·ª©c ho·∫°t ƒë·ªông c·ªßa h·ªá th·ªëng ƒë√≥. V√≠ d·ª•, m·ªôt ·ª©ng d·ª•ng web c√≥ th·ªÉ s·ª≠ d·ª•ng API c·ªßa m·ªôt n·ªÅn t·∫£ng ƒë·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ n·ªÅn t·∫£ng ƒë√≥ v√† hi·ªÉn th·ªã cho ng∆∞·ªùi d√πng.
//API l√† 1 ph·∫ßn m·ªÅm c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi ph·∫ßn m·ªÅm kh√°c ƒë·ªÉ cho ph√©p c√°c ·ª©ng d·ª•ng giao ti·∫øp v·ªõi nhau(dom api,geolocation api,own class api.online api)
//api online :UD ch·∫°y tr√™n m√°y ch·ªß,nh·∫≠n y√™u c·∫ßu d·ªØ li·ªáu g·ª≠i la·ªã d∆∞·ªõi d·∫°ng ph·∫£n h·ªìi
//JavaScript kh√¥ng ƒë·ªìng b·ªô l√† m·ªôt k·ªπ thu·∫≠t cho ph√©p JavaScript th·ª±c hi·ªán c√°c t√°c v·ª• m√† kh√¥ng c·∫ßn ch·ªù cho t√°c v·ª• tr∆∞·ªõc ho√†n th√†nh. Khi m·ªôt t√°c v·ª• kh√¥ng ƒë·ªìng b·ªô ƒëang di·ªÖn ra, tr√¨nh duy·ªát c√≥ th·ªÉ ti·∫øp t·ª•c th·ª±c hi·ªán c√°c t√°c v·ª• kh√°c, ch·∫≥ng h·∫°n nh∆∞ x·ª≠ l√Ω s·ª± ki·ªán, v√† t√°c v·ª• ƒëang di·ªÖn ra s·∫Ω ƒë∆∞·ª£c ho√†n th√†nh sau ƒë√≥. ƒêi·ªÅu n√†y c√≥ th·ªÉ gi√∫p cho tr√¨nh duy·ªát kh√¥ng b·ªã treo khi ph·∫£i ch·ªù cho m·ªôt t√°c v·ª• d√†i ƒë·ªÉ ho√†n th√†nh, v√† gi√∫p cho tr·∫£i nghi·ªám ng∆∞·ªùi d√πng t·ªët h∆°n.
//Ajax (Asynchronous JavaScript and XML) l√† m·ªôt k·ªπ thu·∫≠t cho ph√©p c√°c ·ª©ng d·ª•ng web g·ª≠i v√† nh·∫≠n d·ªØ li·ªáu t·ª´ m√°y ch·ªß m√† kh√¥ng c·∫ßn t·∫£i l·∫°i trang web ho·∫∑c t·∫£i l·∫°i c·∫£ trang. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c√≥ th·ªÉ c·∫≠p nh·∫≠t m·ªôt ph·∫ßn c·ªßa trang m√† kh√¥ng c·∫ßn t·∫£i l·∫°i to√†n b·ªô trang.

// Ajax s·ª≠ d·ª•ng JavaScript ƒë·ªÉ g·ª≠i v√† nh·∫≠n d·ªØ li·ªáu t·ª´ m√°y ch·ªß m√† kh√¥ng c·∫ßn t·∫£i l·∫°i trang web. N√≥ s·ª≠ d·ª•ng XMLHttpRequest ƒë·ªÉ g·ª≠i v√† nh·∫≠n d·ªØ li·ªáu m√† kh√¥ng c·∫ßn t·∫£i l·∫°i trang, ho·∫∑c s·ª≠ d·ª•ng Fetch API. Ajax c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ m√°y ch·ªß, c·∫≠p nh·∫≠t d·ªØ li·ªáu m√† kh√¥ng c·∫ßn t·∫£i l·∫°i trang, ho·∫∑c g·ª≠i d·ªØ li·ªáu ƒë·∫øn m√°y ch·ªß m√† kh√¥ng c·∫ßn t·∫£i l·∫°i trang.

//throw new trong JavaScript l√† m·ªôt c√∫ ph√°p ƒë·ªÉ n√©m ra m·ªôt ngo·∫°i l·ªá. N√≥ cho ph√©p b·∫°n t·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng ngo·∫°i l·ªá v√† n√©m n√≥ ra, ƒë·ªÉ tr√¨nh duy·ªát ho·∫∑c ch∆∞∆°ng tr√¨nh c·ªßa b·∫°n c√≥ th·ªÉ bi·∫øt r·∫±ng c√≥ m·ªôt l·ªói x·∫£y ra v√† c·∫ßn x·ª≠ l√Ω n√≥.
const btn_country = document.querySelector(".btn_country");
const country = document.querySelector(".country");
const request = new XMLHttpRequest();
const renderCoutry = function (data, className = "") {
  {
    const html = `
    <div class="country ${className}">
    <img src="${data.flag}" alt="">
    <div>
        <h3>${data.name}</h3>
        <h4>${data.region}</h4>
        <p>${(data.population / 1000000).toFixed(1)}</p>
        <p>${data.languages[0].name}</p>
        <p>${data.currencies[0].name}</p>
    </div>
    </div>
    `;
    country.insertAdjacentHTML("beforeend", html);
  }
};
// const getcoutryandNeiber = function (countryy) {
//   request.open("GET", `https://restcountries.com/v2/name/${countryy}`);
//   request.send();
//   console.log(request.responseText);
//   request.addEventListener("load", function () {
//     const [data] = JSON.parse(this.responseText);
//     console.log(data);
//     renderCoutry(data);
//     const [neighbour] = data.borders;
//     if (!neighbour) return;
//     //ajax call coutry 2
//     const request2 = new XMLHttpRequest();
//     request2.open("GET", `https://restcountries.com/v2/alpha/${neighbour}`);
//     request2.send();
//     request2.addEventListener("load", function () {
//       const data2 = JSON.parse(this.responseText);
//       console.log(data2);
//       renderCoutry(data2, "neighbour");
//     });
//   });
// };
// getcoutryandNeiber("portugal");

// getcoutry("germany");
// // getcoutryandNeiber("usa");
// const request = fetch("https://restcountries.com/v2/name/portugal");
// console.log(request);
// const renderErr = function (msg) {
//   country.insertAdjacentText("beforeend", msg);
// };
// const getcoutryData = function (country) {
//   fetch(`https://restcountries.com/v2/name/${country}`)
//     .then((response) => response.json())
//     .then((data) => {
//       renderCoutry(data[0]);
//       const neighbour = data[0].borders[0];
//       if (!neighbour) return;
//       return fetch(`https://restcountries.com/v2/alpha/${neighbour}`);
//     })
//     .then((response) => response.json())
//     .then((data) => renderCoutry(data, "neighbour"))
//     .catch((err) => {
//       console.error(`${err}üòµ‚Äçüí´`);
//     });
// };
// btn_country.addEventListener("click", function () {
//   getcoutryData("usa");
//   renderErr("something went wrong");
// });
// console.log("Test start");
// setTimeout(() => console.log("o sec timer"), 0);
// Promise.resolve("resoled promise 2").then((res) => {
//   for (let i = 0; i < 10; i++) {
//     console.log(res);
//   }
// });
// console.log("test end");
// const lotteryPromise = new Promise(function (resole, reject) {
//   console.log("lotte draw is happening");
//   setTimeout(function () {
//     if (Math.random() * 100 > 3.5) {
//       console.log("you win ");
//     } else {
//       reject(new Error("you lost your money"));
//     }
//   }, 2000);
// });
// lotteryPromise
//   .then((res) => console.log(res))
//   .catch((err) => console.error(err));

// const wait = function (seconds) {
//   return new Promise(function (resole) {
//     setTimeout(resole, seconds * 1000);
//   });
// };
// wait(2)
//   .then(() => {
//     console.log("i wanted for 1 seconds");
//     return wait(1);
//   })
//   .then(() => {
//     console.log("i wanted for 2 seconds");
//     return wait(1);
//   })
//   .then(() => {
//     console.log("i wanted for 3 seconds");
//     return wait(1);
//   })
//   .then(() => {
//     console.log("i wanted for 4 seconds");
//     return wait(1);
//   })
//   .then(() => console.log("4 second passed"));
// Promise.resolve("abc").then((x) => console.log(x));
// Promise.reject(new Error("problem!")).catch((x) => console.error(x));
// const getPosition = function () {
//   return new Promise(function (resole, reject) {
//     navigator.geolocation.getCurrentPosition(resole, reject);
//   });
// };
// // getPosition().then((pos) => console.log(pos));

// const whereAmI = () => {
//   getPosition()
//     .then((pos) => {
//       const { latitude: lat, longitude: lng } = pos.coords;
//       fetch(`https://geocode.xyz/${lat},${lng}?geoit=json`);
//     })
//     .then((res) => {
//       if (!res.ok) throw new Error(`Problem with geocoding ${res.status}`);
//       res.json(), console.log(res);
//     })
//     .then((data) => {
//       console.log(data);
//       console.log(`you are in ${data.city},${data.country}`);
//       return fetch(`https:restcountries.eu/rest/v2/name${data.country}`);
//     })
//     .then((data) => renderCoutry(data[0]))
//     .catch((err) => console.error(err.message));
// };

// btn_country.addEventListener("click", whereAmI);
const getPosition = function () {
  return new Promise(function (resole, reject) {
    navigator.geolocation.getCurrentPosition(resole, reject);
  });
};
//Promise v√† Async/Await l√† hai c√¥ng c·ª• m·∫°nh m·∫Ω trong Javascript ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ b·∫•t ƒë·ªìng b·ªô.

// Promise l√† m·ªôt ƒë·ªëi t∆∞·ª£ng trong Javascript, m√† cho ph√©p b·∫°n ch·∫°y m·ªôt t√°c v·ª• b·∫•t ƒë·ªìng b·ªô v√† th√¥ng b√°o k·∫øt qu·∫£ sau khi t√°c v·ª• ƒë√≥ ho√†n th√†nh ho·∫∑c that b·∫°i. B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng Promise ƒë·ªÉ x·ª≠ l√Ω c√°c t√°c v·ª• nh∆∞ g·ª≠i m·ªôt y√™u c·∫ßu HTTP, ƒë·ªçc t·ªáp, ho·∫∑c th·ª±c hi·ªán m·ªôt t√°c v·ª• t√≠nh to√°n ph·ª©c t·∫°p.

// Async/Await l√† m·ªôt t·ª´ kho√° trong Javascript, cho ph√©p b·∫°n vi·∫øt m√£ b·∫•t ƒë·ªìng b·ªô m·ªôt c√°ch d·ªÖ ƒë·ªçc h∆°n v·ªõi c√∫ ph√°p gi·ªëng nh∆∞ m√£ ƒë·ªìng b·ªô. Async/Await cho ph√©p b·∫°n g·ªçi m·ªôt Promise v√† ch·ªù ƒë·ª£i k·∫øt qu·∫£ c·ªßa n√≥ tr∆∞·ªõc khi ti·∫øp t·ª•c th·ª±c hi·ªán c√°c l·ªánh ti·∫øp theo.
const whereAmI = async function () {
  try {
    const pos = await getPosition();
    const { latitude: lat, longitude: lng } = pos.coords;
    const resGeo = await fetch(`https://geocode.xyz/${lat},${lng}?geoit=json`);
    const dataGeo = await resGeo.json();
    console.log(dataGeo);

    const res = await fetch(
      `https://restcountries.com/v2/name/${dataGeo.country}`
    );
    const data = await res.json();
    console.log(data);
    renderCoutry(data[0]);
  } catch {
    (error) => {
      console.error(error + "üòµ‚Äçüí´");
    };
  }
};
// whereAmI();
// whereAmI();
// whereAmI();
// console.log("a");

//try...catch l√† m·ªôt c·∫•u tr√∫c trong Javascript cho ph√©p b·∫°n x·ª≠ l√Ω c√°c l·ªói (exceptions) trong m√£ c·ªßa b·∫°n. N√≥ cho ph√©p b·∫°n ch·∫°y m·ªôt ƒëo·∫°n m√£ trong m·ªôt kh·ªëi try, v√† n·∫øu c√≥ m·ªôt l·ªói x·∫£y ra trong kh·ªëi n√†y, n√≥ s·∫Ω nh·∫£y t·ªõi kh·ªëi catch ƒë·ªÉ x·ª≠ l√Ω l·ªói ƒë√≥.

// V√≠ d·ª•:

// javascript
// Copy code
// try {
//   const result = someFunctionThatMightThrowAnError();
//   console.log(result);
// } catch (error) {
//   console.error('An error occurred:', error);
// }
// Trong v√≠ d·ª• tr√™n, ch√∫ng ta g·ªçi m·ªôt h√†m someFunctionThatMightThrowAnError v√† l∆∞u k·∫øt qu·∫£ c·ªßa n√≥ v√†o bi·∫øn result. N·∫øu c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh g·ªçi h√†m n√†y, n√≥ s·∫Ω b·ªã n√©m ra v√† ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi kh·ªëi catch. Trong kh·ªëi catch, ch√∫ng ta c√≥ th·ªÉ in ra th√¥ng tin v·ªÅ l·ªói ƒë·ªÉ gi√∫p debug.

const getJSON = (url, erroeMsg = "something went wrong") => {
  return fetch(url).then((res) => {
    if (!res.ok) throw new Error(`${erroeMsg}  ${res.status}`);
    return res.json();
  });
};
const get3Country = async function (c1, c2, c3) {
  try {
    const data = await Promise.all([
      getJSON(`https://restcountries.com/v2/name/${c1}`),
      getJSON(`https://restcountries.com/v2/name/${c1}`),
      getJSON(`https://restcountries.com/v2/name/${c1}`),
    ]);
    // const [data1] = await getJSON(`https://restcountries.com/v2/name/${c1}`);
    // const [data2] = await getJSON(`https://restcountries.com/v2/name/${c2}`);
    // const [data3] = await getJSON(`https://restcountries.com/v2/name/${c3}`);
    console.log(data.map((a) => a[0].capital));
  } catch (error) {
    console.log(error);
  }
};

get3Country("portugal", "usa", "brazil");
    </script>
</body>
</html>